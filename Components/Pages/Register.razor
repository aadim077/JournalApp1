@page "/register"
@inject AuthService AuthService
@inject NavigationManager NavigationManager
@inject ISnackbar Snackbar

<MudContainer MaxWidth="MaxWidth.Small" Class="mt-16">
    <MudPaper Elevation="4" Class="pa-8">
        <MudText Typo="Typo.h4" Align="Align.Center" GutterBottom="true">Register</MudText>
        <MudTextField @bind-Value="_username" Label="Username" Variant="Variant.Outlined" Class="mt-4" />
        <MudTextField @bind-Value="_password" Label="Password" Variant="Variant.Outlined" InputType="InputType.Password" Class="mt-4" />
        <MudTextField @bind-Value="_confirmPassword" Label="Confirm Password" Variant="Variant.Outlined" InputType="InputType.Password" Class="mt-4" />
        <MudButton Variant="Variant.Filled" Color="Color.Primary" FullWidth="true" Class="mt-6" OnClick="ProcessRegister">Register</MudButton>
        <MudText Align="Align.Center" Class="mt-4">
            Already have an account? <MudLink Href="/login">Login</MudLink>
        </MudText>
    </MudPaper>
</MudContainer>

@code {
    private string _username = "";
    private string _password = "";
    private string _confirmPassword = "";

    private async Task ProcessRegister()
    {
        if (string.IsNullOrWhiteSpace(_username) || string.IsNullOrWhiteSpace(_password))
        {
            Snackbar.Add("Please fill in all fields", Severity.Error);
            return;
        }

        if (_password != _confirmPassword)
        {
            Snackbar.Add("Passwords do not match", Severity.Error);
            return;
        }

        var result = await AuthService.RegisterAsync(_username, _password);
        if (result.Success)
        {
            Snackbar.Add("Registration successful!", Severity.Success);
            NavigationManager.NavigateTo("/login");
        }
        else
        {
            Snackbar.Add(result.Message, Severity.Error);
        }
    }
}
